"use strict";(globalThis.webpackChunksidis=globalThis.webpackChunksidis||[]).push([[8174],{8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var s=i(6540);const o={},l=s.createContext(o);function a(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(l.Provider,{value:n},e.children)}},9363:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"notifications/action","title":"Action Controller","description":"Descripci\xf3n","source":"@site/docs/notifications/action.md","sourceDirName":"notifications","slug":"/notifications/action","permalink":"/docs/notifications/action","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/notifications/action.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","next":{"title":"Action Examples","permalink":"/docs/notifications/action_examples"}}');var o=i(4848),l=i(8453);const a={sidebar_position:1},r="Action Controller",c={},t=[{value:"Descripci\xf3n",id:"descripci\xf3n",level:2},{value:"Tipos de Acciones Disponibles:",id:"tipos-de-acciones-disponibles",level:3},{value:"Endpoints Disponibles",id:"endpoints-disponibles",level:2},{value:"1. Ejecutar Acci\xf3n Individual",id:"1-ejecutar-acci\xf3n-individual",level:3},{value:"2. Ejecutar Workflow Completo",id:"2-ejecutar-workflow-completo",level:3},{value:"3. Obtener Configuraci\xf3n de Workflow",id:"3-obtener-configuraci\xf3n-de-workflow",level:3},{value:"4. Listar Todas las Configuraciones",id:"4-listar-todas-las-configuraciones",level:3},{value:"Estructura de WorkFlowConfig",id:"estructura-de-workflowconfig",level:2},{value:"Tipos de Acciones Soportadas",id:"tipos-de-acciones-soportadas",level:2},{value:"1. Email (<code>type: &quot;email&quot;</code>)",id:"1-email-type-email",level:3},{value:"2. SMS (<code>type: &quot;sms&quot;</code>)",id:"2-sms-type-sms",level:3},{value:"3. WhatsApp (<code>type: &quot;whatsapp&quot;</code>)",id:"3-whatsapp-type-whatsapp",level:3},{value:"4. Creaci\xf3n de Registros (<code>type: &quot;task&quot;</code>)",id:"4-creaci\xf3n-de-registros-type-task",level:3},{value:"Configuraci\xf3n de la Acci\xf3n:",id:"configuraci\xf3n-de-la-acci\xf3n",level:4},{value:"Ejemplos de Uso:",id:"ejemplos-de-uso",level:4},{value:"Respuestas del API",id:"respuestas-del-api",level:2},{value:"Respuesta Exitosa Individual",id:"respuesta-exitosa-individual",level:3},{value:"Respuesta Exitosa Workflow",id:"respuesta-exitosa-workflow",level:3},{value:"Respuesta de Error",id:"respuesta-de-error",level:3},{value:"Integraci\xf3n con el Flujo de Trabajo",id:"integraci\xf3n-con-el-flujo-de-trabajo",level:2},{value:"Ejemplo de Uso Completo",id:"ejemplo-de-uso-completo",level:2},{value:"Autenticaci\xf3n",id:"autenticaci\xf3n",level:2},{value:"Dependencias",id:"dependencias",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"action-controller",children:"Action Controller"})}),"\n",(0,o.jsx)(n.h2,{id:"descripci\xf3n",children:"Descripci\xf3n"}),"\n",(0,o.jsx)(n.p,{children:"El Action Controller permite ejecutar diferentes tipos de acciones (email, SMS, WhatsApp, creaci\xf3n de registros) basadas en configuraciones de workflow o de forma individual. Est\xe1 dise\xf1ado para trabajar con el diagrama de flujo mostrado en la imagen, donde las acciones pueden ser disparadas por eventos espec\xedficos."}),"\n",(0,o.jsx)(n.h3,{id:"tipos-de-acciones-disponibles",children:"Tipos de Acciones Disponibles:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"email"}),": Env\xedo de correos electr\xf3nicos"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"sms"}),": Env\xedo de mensajes SMS"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"whatsapp"}),": Env\xedo de mensajes WhatsApp"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"task"}),": Creaci\xf3n de registros en cualquier m\xf3dulo (Task, People, Company, etc.)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"endpoints-disponibles",children:"Endpoints Disponibles"}),"\n",(0,o.jsx)(n.h3,{id:"1-ejecutar-acci\xf3n-individual",children:"1. Ejecutar Acci\xf3n Individual"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"POST /actions/execute"})}),"\n",(0,o.jsx)(n.p,{children:"Ejecuta una acci\xf3n espec\xedfica directamente."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Ejemplo de Request:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "actionData": {\n    "id": "action123",\n    "type": "email",\n    "templateId": "template456",\n    "actionId": "abc973943"\n  },\n  "recipients": [\n    {\n      "name": "Juan P\xe9rez",\n      "email": "juan@example.com",\n      "phone": "+1234567890"\n    }\n  ],\n  "triggerData": {\n    "event": "peopleCreate",\n    "timestamp": "2025-10-06T12:00:00.000Z",\n    "userId": "user123"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"2-ejecutar-workflow-completo",children:"2. Ejecutar Workflow Completo"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"POST /actions/workflow/execute"})}),"\n",(0,o.jsx)(n.p,{children:"Ejecuta todas las acciones configuradas para un evento espec\xedfico basado en WorkFlowConfig."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Ejemplo de Request:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "event": "peopleCreate",\n  "peopleId": "670123456789012345678901",\n  "triggerData": {\n    "timestamp": "2025-10-06T12:00:00.000Z",\n    "userId": "user123",\n    "source": "manual"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"3-obtener-configuraci\xf3n-de-workflow",children:"3. Obtener Configuraci\xf3n de Workflow"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"GET /actions/workflow/config/:event"})}),"\n",(0,o.jsx)(n.p,{children:"Obtiene la configuraci\xf3n de workflow para un evento espec\xedfico."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Ejemplo:"})," ",(0,o.jsx)(n.code,{children:"GET /actions/workflow/config/peopleCreate"})]}),"\n",(0,o.jsx)(n.h3,{id:"4-listar-todas-las-configuraciones",children:"4. Listar Todas las Configuraciones"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"GET /actions/workflow/configs"})}),"\n",(0,o.jsx)(n.p,{children:"Obtiene todas las configuraciones de workflow disponibles."}),"\n",(0,o.jsx)(n.h2,{id:"estructura-de-workflowconfig",children:"Estructura de WorkFlowConfig"}),"\n",(0,o.jsxs)(n.p,{children:["Para que el sistema funcione correctamente, necesitas crear documentos en la colecci\xf3n ",(0,o.jsx)(n.code,{children:"WorkFlowConfig"})," con la siguiente estructura:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "_id": "989374673",\n  "event": "peopleCreate",\n  "actions": [\n    {\n      "id": "action1",\n      "event": "email/sms/whatsapp/task",\n      "actionId": "abc973943",\n      "type": "email",\n      "templateId": "1abc936283",\n      "segmentId": "1abc936283",\n      "period": "oneShoot_recurrent",\n      "startAt": "2025/10/02 12:00:00",\n      "shootBy": "peopleCreate_peopleUpdate_etc"\n    },\n    {\n      "id": "action2",\n      "event": "email/sms/whatsapp/task",\n      "actionId": "def456789",\n      "type": "sms",\n      "templateId": "2abc936284",\n      "segmentId": "1abc936283",\n      "period": "oneShoot_recurrent",\n      "startAt": "2025/10/02 12:05:00",\n      "shootBy": "peopleCreate_peopleUpdate_etc"\n    }\n  ]\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"tipos-de-acciones-soportadas",children:"Tipos de Acciones Soportadas"}),"\n",(0,o.jsxs)(n.h3,{id:"1-email-type-email",children:["1. Email (",(0,o.jsx)(n.code,{children:'type: "email"'}),")"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Utiliza el controlador ",(0,o.jsx)(n.code,{children:"mailgun.controller.ts"})]}),"\n",(0,o.jsxs)(n.li,{children:["Funci\xf3n: ",(0,o.jsx)(n.code,{children:"sendEmailCorporate"})]}),"\n",(0,o.jsx)(n.li,{children:"Requiere: destinatarios con email v\xe1lido"}),"\n",(0,o.jsx)(n.li,{children:"Opcional: templateId para contenido personalizado"}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"2-sms-type-sms",children:["2. SMS (",(0,o.jsx)(n.code,{children:'type: "sms"'}),")"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Utiliza el controlador ",(0,o.jsx)(n.code,{children:"twilio.controller.ts"})]}),"\n",(0,o.jsxs)(n.li,{children:["Funci\xf3n: ",(0,o.jsx)(n.code,{children:"sendTwilio"})]}),"\n",(0,o.jsx)(n.li,{children:"Requiere: destinatarios con tel\xe9fono v\xe1lido"}),"\n",(0,o.jsx)(n.li,{children:"Opcional: templateId para contenido personalizado"}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"3-whatsapp-type-whatsapp",children:["3. WhatsApp (",(0,o.jsx)(n.code,{children:'type: "whatsapp"'}),")"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Utiliza el controlador ",(0,o.jsx)(n.code,{children:"twilio.controller.ts"})]}),"\n",(0,o.jsxs)(n.li,{children:["Funci\xf3n: ",(0,o.jsx)(n.code,{children:"sendTwilio"})," (con path ",(0,o.jsx)(n.code,{children:"/whatsapp"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Requiere: destinatarios con tel\xe9fono v\xe1lido"}),"\n",(0,o.jsx)(n.li,{children:"Opcional: templateId para contenido personalizado"}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"4-creaci\xf3n-de-registros-type-task",children:["4. Creaci\xf3n de Registros (",(0,o.jsx)(n.code,{children:'type: "task"'}),")"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"NUEVO"}),": Crea registros en cualquier m\xf3dulo del sistema"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"M\xf3dulo por defecto"}),": Task (si no se especifica ",(0,o.jsx)(n.code,{children:"targetModule"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"M\xf3dulos soportados"}),": Task, People, Company, o cualquier m\xf3dulo disponible"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Configuraci\xf3n flexible"}),": Permite definir estructura de datos personalizada"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Variables din\xe1micas"}),": Reemplaza variables como ",(0,o.jsx)(n.code,{children:"{{name}}"}),", ",(0,o.jsx)(n.code,{children:"{{email}}"}),", ",(0,o.jsx)(n.code,{children:"{{phone}}"})]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"configuraci\xf3n-de-la-acci\xf3n",children:"Configuraci\xf3n de la Acci\xf3n:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "type": "task",\n  "targetModule": "People",  // M\xf3dulo donde crear el registro\n  "templateId": "template123", // Opcional: template con estructura de datos\n  "recordData": {            // Datos espec\xedficos del registro\n    "name": "{{name}}",\n    "email": "{{email}}",\n    "source": "workflow-automation",\n    "tags": ["automated", "workflow"]\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"ejemplos-de-uso",children:"Ejemplos de Uso:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Crear Tarea"}),": ",(0,o.jsx)(n.code,{children:'targetModule: "Task"'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Crear Persona"}),": ",(0,o.jsx)(n.code,{children:'targetModule: "People"'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Crear Empresa"}),": ",(0,o.jsx)(n.code,{children:'targetModule: "Company"'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cualquier m\xf3dulo"}),": ",(0,o.jsx)(n.code,{children:'targetModule: "NombreDelModulo"'})]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"respuestas-del-api",children:"Respuestas del API"}),"\n",(0,o.jsx)(n.h3,{id:"respuesta-exitosa-individual",children:"Respuesta Exitosa Individual"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "message": "Acci\xf3n ejecutada exitosamente",\n  "data": {\n    "success": true,\n    "message": "Email enviado exitosamente",\n    "recipientsCount": 1\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"respuesta-exitosa-workflow",children:"Respuesta Exitosa Workflow"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "message": "Workflow ejecutado",\n  "event": "peopleCreate",\n  "totalActions": 2,\n  "results": [\n    {\n      "actionId": "abc973943",\n      "type": "email",\n      "result": {\n        "success": true,\n        "message": "Email enviado exitosamente",\n        "recipientsCount": 1\n      }\n    },\n    {\n      "actionId": "def456789",\n      "type": "sms",\n      "result": {\n        "success": true,\n        "message": "SMS enviado exitosamente",\n        "recipientsCount": 1\n      }\n    }\n  ]\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"respuesta-de-error",children:"Respuesta de Error"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "success": false,\n  "message": "Error ejecutando acci\xf3n",\n  "error": "Descripci\xf3n del error espec\xedfico"\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"integraci\xf3n-con-el-flujo-de-trabajo",children:"Integraci\xf3n con el Flujo de Trabajo"}),"\n",(0,o.jsx)(n.p,{children:"Basado en el diagrama de la imagen, el flujo funciona as\xed:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"SidisChange (intern)"})," - Detecta cambios en los datos"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"WorkFlowConfig"})," - Define qu\xe9 acciones ejecutar"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Action Controller"})," - Ejecuta las acciones correspondientes:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Send Email"}),"\n",(0,o.jsx)(n.li,{children:"Send SMS"}),"\n",(0,o.jsx)(n.li,{children:"Send WhatsApp"}),"\n",(0,o.jsx)(n.li,{children:"Create Task"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"ejemplo-de-uso-completo",children:"Ejemplo de Uso Completo"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Crear configuraci\xf3n de workflow:"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'// Crear en MongoDB colecci\xf3n WorkFlowConfig\n{\n  "event": "peopleCreate",\n  "actions": [\n    {\n      "id": "welcome-email",\n      "type": "email",\n      "templateId": "welcome-template-id",\n      "actionId": "welcome001"\n    },\n    {\n      "id": "welcome-task",\n      "type": "task", \n      "targetModule": "Task",\n      "templateId": "task-template-id",\n      "actionId": "task001",\n      "recordData": {\n        "title": "Bienvenida para {{name}}",\n        "priority": "high",\n        "status": "pending"\n      }\n    },\n    {\n      "id": "create-backup-person",\n      "type": "task",\n      "targetModule": "People",\n      "actionId": "backup001", \n      "recordData": {\n        "name": "{{name}} - Backup",\n        "email": "{{email}}",\n        "source": "workflow-backup",\n        "tags": ["backup", "automated"]\n      }\n    }\n  ]\n}\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Disparar el workflow:"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'// POST /actions/workflow/execute\n{\n  "event": "peopleCreate",\n  "peopleId": "670123456789012345678901",\n  "triggerData": {\n    "timestamp": "2025-10-06T12:00:00.000Z",\n    "userId": "user123"\n  }\n}\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"El sistema autom\xe1ticamente:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'Busca la configuraci\xf3n para el evento "peopleCreate"'}),"\n",(0,o.jsx)(n.li,{children:"Obtiene los datos de la persona por ID"}),"\n",(0,o.jsx)(n.li,{children:"Ejecuta el email de bienvenida"}),"\n",(0,o.jsx)(n.li,{children:"Crea una tarea de seguimiento en el m\xf3dulo Task"}),"\n",(0,o.jsx)(n.li,{children:"Crea un registro de respaldo en el m\xf3dulo People"}),"\n",(0,o.jsx)(n.li,{children:"Retorna el resultado de todas las acciones"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"autenticaci\xf3n",children:"Autenticaci\xf3n"}),"\n",(0,o.jsxs)(n.p,{children:["Todos los endpoints requieren autenticaci\xf3n JWT v\xe1lida mediante el middleware ",(0,o.jsx)(n.code,{children:"validateJWT"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"dependencias",children:"Dependencias"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"mailgun.controller.ts"})," - Para env\xedo de emails"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"twilio.controller.ts"})," - Para SMS y WhatsApp"]}),"\n",(0,o.jsxs)(n.li,{children:["Modelos: ",(0,o.jsx)(n.code,{children:"WorkFlowConfig"}),", ",(0,o.jsx)(n.code,{children:"Template"}),", ",(0,o.jsx)(n.code,{children:"People"}),", ",(0,o.jsx)(n.code,{children:"Task"})]}),"\n",(0,o.jsxs)(n.li,{children:["Middlewares: ",(0,o.jsx)(n.code,{children:"validateJWT"})]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);